!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dndSort=t():e.dndSort=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){var r,o,i;o=[t],void 0===(i="function"==typeof(r=function(e){"use strict";function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=Function.prototype.call,a=i.bind(Array.prototype.slice),u=document.documentElement,c=window,s=function(e){return"function"==typeof e},f=function(e){var t=[];return e.forEach(function(e){t.includes(e)||t.push(e)}),t},l=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},d=0,h=i.bind(Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1}),v=i.bind(Element.prototype.closest||function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(h(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),p=function(e){if(e.nodeType)return e;if((r=e)&&"object"===(void 0===r?"undefined":o(r))&&isFinite(r.length)&&r.length>=0&&r.length===Math.floor(r.length)&&r.length<4294967296&&!r.nodeType){for(var t=document.createDocumentFragment(),n=0;n<e.length;n++)t.appendChild(e[n]);return t}var r},g=/[A-Z]/g,m=function(e){return e.replace(g,function(e,t){return(0===t?"":"-")+e.toLowerCase()})};function y(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}var b=document.createElement("div"),k=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t?t=[]:t===window?t=[window]:t.nodeType?t=[t]:(Array.isArray(t)||(t=Array.from(t)),t=t.filter(function(e){return e===window||e&&e.nodeType})),this.nodes=t,t.forEach(function(e,t){return n[t]=e}),this.length=t.length,L.forEach(function(e){"constructor"!==e&&(n[e]=n[e].bind(n))})}return r(e,[{key:"each",value:function(e){return this.nodes.forEach(e),this}},{key:"map",value:function(e){return this.nodes.map(e)}},{key:"filter",value:function(e){return this.nodes.filter(e)}},{key:"eq",value:function(t){return new e(this.nodes[t])}},{key:"first",value:function(){return this.eq(0)}},{key:"last",value:function(){return this.eq(this.length-1)}},{key:"classNames",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return a(this.nodes[e].classList)}},{key:"addClass",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===(t=t.map(function(e){return e.trim()}).filter(function(e){return e})).length?this:this.each(function(e,r){var o;(o=e.classList).add.apply(o,n(t))})}},{key:"removeClass",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===(t=t.map(function(e){return e.trim()}).filter(function(e){return e})).length?this:this.each(function(e,r){var o;(o=e.classList).remove.apply(o,n(t))})}},{key:"toggleClass",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return 0===(n=n.map(function(e){return e.trim()}).filter(function(e){return e})).length?this:this.nodes[0].classList.toggle?this.each(function(e,t){n.forEach(function(t){e.classList.toggle(t)})}):this.each(function(t,r){o=e.classNames(r),i=[],a=[],n.forEach(function(e){o.includes(e)?i.push(e):a.push(e)}),i.length&&e.removeClass.apply(e,i),a.length&&e.addClass.apply(e,a)});var o,i,a}},{key:"hasClass",value:function(e){return this.nodes.some(function(t){return t.classList.contains(e)})}},{key:"parent",value:function(){return new e(this.map(function(e){return e.parentNode}))}},{key:"parents",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this.nodes[t].parentNode,r=[];n;)r.push(n),n=n.parentNode;return new e(r)}},{key:"children",value:function(){return new e(f(l(this.map(function(e){return a(e.children)}))))}},{key:"next",value:function(){return new e(this.map(function(e){return y(e,"nextSibling")}))}},{key:"prev",value:function(){return new e(this.map(function(e){return y(e,"previousSibling")}))}},{key:"find",value:function(t){return new e(f(l(this.map(function(e){return a(e.querySelectorAll(t))}))))}},{key:"includes",value:function(e){return this.nodes.includes(e)}},{key:"closest",value:function(t){return new e(this.nodes.map(function(e){return v(e,t)}))}},{key:"match",value:function(e){return this.nodes.some(function(t){return h(t,e)})}},{key:"val",value:function(e){return void 0===e?this.map(function(e){return e.value||""}).join(""):this.each(function(t){return t.value=e})}},{key:"attr",value:function(e,t){if(t)return this.each(function(n){return n.setAttribute(e,t)});if("string"==typeof e)return this.map(function(t){return t.getAttribute(e)}).join(" ");if("object"===(void 0===e?"undefined":o(e))){for(var n in e)this.each(function(t){return t.setAttribute(n,e[n])});return this}}},{key:"removeAttr",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){e.each(function(e){return e.removeAttribute(t)})}),this}},{key:"html",value:function(e){return void 0===e?this.map(function(e){return e.innerHTML}).join(""):this.each(function(t){return t.innerHTML=e})}},{key:"outerHtml",value:function(e){return void 0===e?this.map(function(e){return e.outerHTML}).join(""):this.each(function(t){return t.outerHTML=e})}},{key:"text",value:function(e){return void 0===e?this.map(function(e){return e.innerText}).join(""):this.each(function(t){return t.innerText=e})}},{key:"style",value:function(e,t){var n={};if("string"==typeof e){if(void 0===t)return this[0].style[e];n[e]=t}else{if("object"!==(void 0===e?"undefined":o(e)))return this;n=e}for(var r in n)this.each(function(e){e.style[r]=n[r]});return this}},{key:"removeStyle",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this.removeAttr("style"):this.each(function(e){t.forEach(function(t){e.style.removeProperty(t)})})}},{key:"computeStyle",value:function(e){return window.getComputedStyle(this.nodes[0],e)}},{key:"maxScroll",value:function(){var e=this[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0];return e.scrollHeight-e.clientHeight}},{key:"append",value:function(e){if(!(e=p(e)))return this;var t=this.length-1;return this.each(function(n,r){n.appendChild(r===t?e:e.cloneNode(!0))})}},{key:"prepend",value:function(e){if(!(e=p(e)))return this;var t=this.length-1;return this.each(function(n,r){n.insertBefore(r===t?e:e.cloneNode(!0),n.firstChild)})}},{key:"insertBefore",value:function(e){if(!(e=p(e)))return this;var t=this.length-1;return this.each(function(n,r){n.parentNode.insertBefore(r===t?e:e.cloneNode(!0),n)})}},{key:"insertAfter",value:function(e){if(!(e=p(e)))return this;var t=this.length-1;return this.each(function(n,r){var o=n.nextElementSibling,i=n.parentNode,a=r===t?e:e.cloneNode(!0);o?i.insertBefore(a,o):i.appendChild(a)})}},{key:"replace",value:function(e){if(!(e=p(e)))return this;var t=this.length-1;return this.each(function(n,r){n.parentNode.replaceChild(r===t?e:e.cloneNode(!0),n)})}},{key:"remove",value:function(){return this.each(function(e){e.parentNode&&e.parentNode.removeChild(e)})}},{key:"hide",value:function(){var e=this;return this.each(function(t,n){var r=e.eq(n),o=r.computeStyle().display;"none"!==o&&(r.dataset("_pre_display",o),r.style("display","none"))})}},{key:"show",value:function(e){var t=this;return this.each(function(n,r){var o=t.eq(r),i=o.computeStyle().display;if("none"===i)if(e)o.style("display",e);else{var a=o.dataset("_pre_display");if(a)o.style("display",a);else{if("none"===o.style("display")&&(o.removeStyle("display"),"none"!==(i=o.computeStyle().display)))return;o.style("display","block")}}})}},{key:"clone",value:function(t){return new e(this.map(function(e){return e.cloneNode(t)}))}},{key:"offset",value:function(){var e=this[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0].getBoundingClientRect();return{left:e.left+(c.pageXOffset||u.scrollLeft||document.body.scrollLeft)-u.clientLeft,top:e.top+(c.pageYOffset||u.scrollTop||document.body.scrollTop)-u.clientTop}}},{key:"trigger",value:function(e,t){return this.each(function(n){T(n,e,t)})}},{key:"on",value:function(e,t){return this.each(function(n,r){n.addEventListener(e,t),C(n,e,t)})}},{key:"off",value:function(e,t){return this.each(function(n,r){var o=D(n),i={};for(var a in e?i[e]=t?[t]:o[e]:i=o,i)i[a].forEach(function(e){return n.removeEventListener(a,e)});N(n,e,t)})}},{key:"onDelegate",value:function(e,n,r){return this.each(function(o){var i=D(o),u=i[e]&&i[e].find(function(e){return e.isDelegate});if(u){var c=u.cache;c[n]?c[n].push(r):c[n]=[r]}else{var s=function e(t){var n=function(e){var t=e.path||e.composedPath&&e.composedPath();return t&&0!==t.length?t:((t=new k(e.target).parents().nodes).unshift(e.target),t.push(window),t)}(t),r=[],i=e.cache;for(var u in i)r.push({queryNodes:a(o.querySelectorAll(u)),fns:i[u]});var c=n.length;r.forEach(function(e){for(var r=e.queryNodes,o=e.fns,i=function(){var e=n[a];if(r.includes(e))return o.forEach(function(n){n.call(e,t)}),"break"},a=c;a>-1&&"break"!==i();a--);})};s.cache=t({},n,[r]),s.isDelegate=!0,o.addEventListener(e,s),C(o,e,s)}})}},{key:"offDelegate",value:function(e,n,r){return this.each(function(o){var i=D(o);if(i){var a;if(e){if(!i[e])return;a=t({},e,i[e].filter(function(e){return e.isDelegate}))}else a=function(e,t){var n={};for(var r in e)n[r]=t(e[r]);return n}(i,function(e){return e.filter(function(e){return e.isDelegate})});if(n)a[e].forEach(function(t){var i=t.cache;if(i[n])if(r){var a=i[n].indexOf(r);i[n].splice(a,1)}else i[n]=void 0;0===Object.keys(i).filter(function(e){return i[e]&&i[e].length>0}).length&&(o.removeEventListener(e,t),N(o,e,t))});else for(var u in a)a[u].forEach(function(e){o.removeEventListener(u,e),N(o,u,e)})}})}}]),e}();k.prototype.dataset=b.dataset?function(e,t){if(t)return this.each(function(n){return n.dataset[e]=t});if("string"==typeof e)return this.map(function(t){return t.dataset[e]}).join("");if("object"===(void 0===e?"undefined":o(e)))for(var n in e)this.each(function(t){return t.dataset[n]=e[n]});return this}:function(e,t){var n;if("string"==typeof e)n="data-"+m(e);else if("object"===(void 0===e?"undefined":o(e)))for(var r in n={},e)n["data-"+m(r)]=e[r];return this.attr(n,t)};var w={},E=function(e){var t=e._expando_e$id;return t||(t=e._expando_e$id=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")+d++}("node")),t},D=function(e){var t=E(e),n=w[t];return n||(n=w[t]={}),n},C=function(e,t,n){var r=D(e);r[t]?r[t].push(n):r[t]=[n]},N=function(e,t,n){var r=E(e),o=w[r];o&&(t||(w[r]=void 0),o[t]&&(n?(o[t]=o[t].filter(function(e){return e!==n}),0===o[t].length&&(o[t]=void 0)):o[t]=void 0))},S=function(e,t){if(s(Event))return new Event(e,t);var n=document.createEvent("MouseEvents");return n.initEvent(e,!0,!0),t&&Object.assign(n,t),n},A=function(e,t,n){return s(e)?new e(t,n):S(t,n)},x=A.bind(void 0,MouseEvent),$=[[/^key.*/,A.bind(void 0,KeyboardEvent)],[/^(.*click|mouse.*|drop)/,x],[/^(focus.*|blur)/,A(void 0,FocusEvent)],[/^wheel/,A(void 0,WheelEvent)]],j={focus:{check:function(e){return e.focus},trigger:function(e){e.focus()}},blur:{check:function(e){return e.blur},trigger:function(e){e.blur()}},click:{check:function(e){return e.click},trigger:function(e){e.click()}}},T=function(e,t,n){if(t=t.trim(),j[t]&&j[t].check(e))j[t].trigger(e);else{var r=function(e,t){var n=$.find(function(t){return t[0].test(e)});return n?n[1](e,t):S(e,t)}(t,n);e.dispatchEvent(r)}};function O(e){return new k("string"==typeof e?document.querySelectorAll(e):e)}["offset","client","scroll"].forEach(function(e){["Height","Width","Top","Left"].forEach(function(t){var n=e+t;k.prototype[n]=function(){return this[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0][n]}})}),O.fragment=function(e){b.innerHTML=e;for(var t,n=document.createDocumentFragment();t=b.firstChild;)n.appendChild(t);return n};var _=/</;O.create=function(e){return _.test(e)?(b.innerHTML=e,new k(b.children)):new k(document.createElement(e))};var L=Object.getOwnPropertyNames(k.prototype);e.default=O})?r.apply(t,o):r)||(e.exports=i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={},o={clear:function(e){e?r[e]=void 0:r={}},set:function(e){r.hasData=!0,Object.assign(r,e)},get:function(e){return r[e]},hasData:function(){return r.hasData}},i=0;o.getGuid=function(){return"__dragSort"+i+++"_"},o._state=function(){return r},t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.default=function(e,t){return new k(e,t).dispose};var o=a(n(1)),i=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var u=navigator.userAgent.indexOf("Firefox")>0,c=function(e,t){return e.parentNode===t},s=function(e,t){do{if(e===t){e=null;break}if(c(e,t))break}while(e=e.parentNode);return e},f=function(e,t){Object.keys(e).forEach(function(n){t.on(n,e[n])})},l=function(e,t){Object.keys(e).forEach(function(n){t.off(n,e[n])})},d=function(e,t){for(var n=0;e=e.previousSibling;)1===e.nodeType&&e!==t&&n++;return n},h=function(e){if(null==e)return"*";var t={name:[],fn:[]};return v(e)?(e.forEach(function(e){"string"==typeof e?t.name.push(e):"function"==typeof e&&t.fn.push(e)}),t):(t.name=[e+""],t)},v=Array.isArray,p=function(e){if(o.default.hasData())return e.preventDefault(),e.stopPropagation(),!1},g=function(e){o.default.hasData()&&(e.preventDefault(),e.stopPropagation())},m=function(e,t){if(e)return e.apply(null,t)},y=function(e,t,n){var r;do{if(r=n(e))break}while(e!==t&&e===e.parentNode);return r},b=function(e){var t=k.prototype;Object.getOwnPropertyNames(t).forEach(function(n){"constructor"!==n&&"function"==typeof t[n]&&(e[n]=e[n].bind(e))})},k=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=this.$root=(0,i.default)(t);r.find("a,img,input,textarea").each(function(e){e.draggable=!1}),this.className={chosen:n.clsChosen||"dragChosen",image:n.clsImage||"dragImage",holder:n.clsHolder||"dragHolder"},this.group={name:n.name||o.default.getGuid(),drop:h(n.drop),dropAllow:h(n.dropAllow)},this.startIndex=void 0,this.$drag=null,this.$clone=null,b(this),this.listeners={mousedown:this.mouseDownCb,dragend:this.dragEndCb,dragenter:p,dragover:this.dragOverCb,drop:g},f(this.listeners,r),this.hasHolder=n.hasHolder,this.checkDataset=n.checkDataset,this.cb={onDragStart:n.onDragStart,onDragOver:n.onDragOver,onDragEnd:n.onDragEnd,dataTransfer:n.dataTransfer,template:n.template},this.isDispose=!1}return r(e,[{key:"mouseDownCb",value:function(e){var t,n,r,o,a=s(e.target,this.$root[0]);a&&(this.startIndex=d(a),!1!==(t=this,n=e.target,r=a,!1!==(o=m(t.cb.onDragStart,[t.startIndex,t.group.name,n,r]))&&t.checkDataset&&(o=!y(n,r,function(e){var t=(0,i.default)(e);return"true"===t.dataset("ignoreDrag")||"true"===t.dataset("ignoreDnd")})),o)&&(a.draggable=!0,this.$drag=(0,i.default)(a),this.$clone=this.$drag.clone(!0),function(){try{document.selection?setTimeout(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}}(),f({dragstart:this.dragStartCb,mouseup:this.clear},this.$root),(0,i.default)(document).on("drop",g)))}},{key:"dragStartCb",value:function(e){var t=this,n=e.dataTransfer;n.effectAllowed="copyMove",u&&n.setData("Text",this.$clone.outerHtml());var r=this.group.name,i=this.$drag,a=this.$clone;o.default.set({data:function(e){var t=e.cb.dataTransfer;if(t)return t(e.startIndex,e.$drag[0],e.group.name)}(this),group:this.group,$clone:a,$drag:i,curName:r,curClassName:this.className,prevSortItem:null});var c=this.className;i.addClass(c.image),setTimeout(function(){i.removeClass(c.image),t.hasHolder?i.addClass(c.holder):(console.log("hide drag"),i.insertAfter(a).hide()),a.addClass(c.chosen)},0)}},{key:"dragOverCb",value:function(e){if(o.default.hasData()){console.log("dragover=============");var t=e.dataTransfer;t.dropEffect="move",e.preventDefault();var n=s(e.target,this.$root[0]);if(o.default.get("prevSortItem")!==n){o.default.set({prevSortItem:n}),console.log("dragover valid",n);var r=o.default.get("$clone");if(n!==r[0]){var a=this.$drag,u=o.default.get("group");if(console.log("fromGroup:",u),a||function(e,t){var n=e.drop,r=t.dropAllow,o=e.name,i=t.name;return"*"!==n?n.name.includes(i)||n.fn.some(function(e){return e(i)}):"*"===r||r.name.includes(o)||r.fn.some(function(e){return e(o)})}(u,this.group)){if(n&&!1===function(e,t,n,r){var o=m(e.cb.onDragOver,[t.name,e.group.name,n,r]);return!1!==o&&e.checkDataset&&(o=!y(n,r,function(e){var t=(0,i.default)(e);return"true"===t.dataset("ignoreDrop")||"true"===t.dataset("ignoreDnd")})),o}(this,u,n&&e.target,n))return console.log("dragover: false"),void(t.dropEffect="none");var c,f,l,d,h,v=o.default.get("curName")!==this.group.name,p=u.name===this.group.name;if(v&&(r.remove(),r=p?this.$clone:(l=(c=this).cb.template,d=l&&l(o.default.get("data"),o.default.get("group").name,o.default.get("curName")),h=o.default.get("curClassName").chosen,d?f="string"==typeof d?i.default.create(d):(0,i.default)(d):(console.log("createExternalItem remove chosen",h),(f=o.default.get("$clone")).removeClass(h)),f.addClass(c.className.chosen),f),o.default.set({$clone:r,curName:this.group.name,curClassName:this.className})),v||n)if(n){var g=(0,i.default)(n),b=g.prev(),k=g.next();if(p){if(n===this.$drag[0]||this.hasHolder&&b[0]===r[0]&&k[0]===this.$drag[0])return console.log("remove clone"),void r.remove();if(b[0]===this.$drag[0]){if(this.hasHolder)return void g.insertAfter(r);b=b.prev()}}console.log("dragover insert :",b[0]===r[0]?"after":"before",b[0],r[0]),b[0]===r[0]?g.insertAfter(r):g.insertBefore(r)}else this.$root.prepend(r)}else t.dropEffect="none"}else console.log("hover clone")}}}},{key:"dragEndCb",value:function(e){this.moveDnd(),this.clear()}},{key:"moveDnd",value:function(){var e=o.default.get("$clone"),t=o.default.get("$drag");console.log(e.parent());var n=0===e.parent().length?this.startIndex:d(e[0],t[0]),r=this.startIndex,i=o.default.get("group").name,a=o.default.get("curName"),u=i!==a;console.log(r,n),u||r!==n?(u?(t.remove(),e.removeClass(this.className.chosen)):(e.replace(t),t.show()),function(e,t,n,r,o){console.log("trigger on DragEnd"),m(e.cb.onDragEnd,[t,n,r,o])}(this,r,n,i,a)):(e.remove(),t.show())}},{key:"clear",value:function(){l({dragstart:this.dragStartCb,mouseup:this.clear},this.$root),(0,i.default)(document).off("drop",g),this.$drag&&(this.$drag[0].draggable=!1,this.$drag.removeClass(this.className.holder)),this.$clone=this.$drag=null,o.default.clear(),this.startIndex=void 0,this.isDispose=!0}},{key:"dispose",value:function(){this.isDispose||(this.clear(),l(this.listeners,this.$root))}}]),e}();e.exports=t.default}])});